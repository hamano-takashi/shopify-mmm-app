# 要件定義書: Shopify MMM App

> BOARD Agent 策定 | 2026-02-28
> 5つの検証レンズ（前提検証/代替案/リスク/データ裏付け/実行可能性）を通過

---

## 1. プロダクトビジョン

### 1.1 ミッション

「初めてのMMM」を中小ECに届ける。

Shopifyストアオーナーが、インストールから MMM 分析結果の確認まで **30分以内** で完了できるアプリ。

### 1.2 ポジショニング

| 項目 | 内容 |
|------|------|
| ターゲット | 月商100万〜3億円のEC事業者 |
| 価格帯 | 月$99〜$299（競合の1/5〜1/10） |
| 言語 | 日本語ファースト → 英語展開 |
| 差別化 | Shopifyデータ自動取得 + Excelテンプレート手動補完 + 楽天/Amazon JP対応 |

### 1.3 Why Shopifyネイティブか

| 評価軸 | スタンドアロンSaaS | **Shopifyアプリ（採用）** | Excel配布型 |
|---|---|---|---|
| 集客 | 自力マーケ必要 | **App Store検索で発見される** | 口コミ依存 |
| データ連携 | API個別構築 | **売上/PV/セッション自動取得** | 全手動 |
| 信頼性 | ゼロから構築 | **Shopifyの信頼を借りられる** | 低い |
| 決済 | Stripe等を独自実装 | **Billing APIで自動課金** | PayPal等 |
| 初期コスト | 高 | **中（テンプレートあり）** | 低 |

---

## 2. データ取得アーキテクチャ

### 2.1 ハイブリッドデータ取得

MMMに必要なデータの約半分はShopify APIで自動取得可能。残りはExcelテンプレートで手動補完する。

```
Tier 1: Shopify API 自動取得（アプリインストールだけで完了）
├── 日次売上・注文数（ShopifyQL sales テーブル）
├── PV・セッション・訪問者数（ShopifyQL sessions テーブル）
├── 新規/リピーター比率（ShopifyQL sales テーブル）
├── 割引・クーポン利用状況（Orders API）
└── 在庫スナップショット（Inventory API、日次バッチ）

Tier 2: Excelテンプレート アップロード（手動補完）
├── 楽天RPP / Amazon SP / Yahoo広告データ
├── モールイベント・セールフラグ
├── CFキャンペーン・PR配信フラグ
├── LINE友だち数・メール配信数
└── 天候・価格指数

Tier 3: 外部API連携（v2以降で段階的追加）
├── Google Ads API → 広告データ自動取得
├── Meta Marketing API → 広告データ自動取得
├── 気象庁API → 天候データ自動取得
└── Amazon SP-API → 売上・広告データ自動取得（将来）
```

### 2.2 Shopify API 取得可否一覧

| カテゴリ | データ | Shopify API | 手動補完 |
|---|---|---|---|
| **目的変数** | 日次売上 | ShopifyQL `sales` | 不要 |
| | 日次注文数 | ShopifyQL `sales` | 不要 |
| **メディア変数** | Google広告 費用/IMP | MarketingEngagement（条件付き） | Excelアップロードも可 |
| | Meta広告 費用/IMP | MarketingEngagement（条件付き） | Excelアップロードも可 |
| | 楽天RPP 費用/IMP | **取得不可** | **Excelアップロード必須** |
| | Amazon SP 費用/IMP | **取得不可** | **Excelアップロード必須** |
| | Yahoo広告 費用/IMP | **取得不可** | **Excelアップロード必須** |
| | TikTok/LINE広告 | 条件付き | Excelアップロードも可 |
| **コンテキスト** | 自社EC PV/セッション | ShopifyQL `sessions` | 不要 |
| | 新規/リピーター比率 | ShopifyQL `sales` | 不要 |
| | 割引利用状況 | Orders API | 不要 |
| | モールイベント/セール | **取得不可** | **Excelアップロード必須** |
| | 天候/価格指数 | **取得不可** | **外部API or Excel** |

### 2.3 必要なShopify APIスコープ

| スコープ | 用途 | 必須/任意 |
|---|---|---|
| `read_orders` | 注文データ取得 | 必須 |
| `read_all_orders` | 60日以上前の注文取得（MMM分析に必須） | 必須（要申請） |
| `read_reports` | ShopifyQL分析データ取得 | 必須 |
| `read_inventory` | 在庫データ取得 | 任意（v1では省略可） |
| `read_products` | 商品情報取得 | 任意 |
| `read_customers` | 顧客データ取得 | 任意 |

---

## 3. 機能要件

### 3.1 MVP（v1.0）

| # | 機能 | 詳細 | 優先度 |
|---|---|---|---|
| F1 | **Shopifyデータ自動取得** | ShopifyQL経由で売上/注文/PV/セッションを日次自動取得 | 必須 |
| F2 | **Excelテンプレート ダウンロード** | 数式・バリデーション付きテンプレートをアプリ内からDL | 必須 |
| F3 | **Excelアップロード＆バリデーション** | データ品質チェック（欠損率・異常値・期間整合性）を即座にフィードバック | 必須 |
| F4 | **データマージ＆プレビュー** | Shopify自動取得データ + アップロードデータを統合しプレビュー表示 | 必須 |
| F5 | **MMM実行** | バックエンドでMMM実行。チャネル別貢献度・ROASを算出 | 必須 |
| F6 | **結果ダッシュボード** | チャネル別貢献度グラフ、飽和曲線、予算配分提案をPolaris UIで表示 | 必須 |
| F7 | **結果Excelダウンロード** | 講義テンプレート形式（optimize.xlsm互換）で結果をDL可能 | 必須 |
| F8 | **GDPR対応** | 3つの必須Webhook実装 | 必須 |
| F9 | **Billing** | 月額サブスクリプション（Managed Pricing） | 必須 |
| F10 | **日本語UI** | 全画面日本語。Polaris Web Components準拠 | 必須 |

### 3.2 v2.0（自動化強化）

| # | 機能 | 詳細 |
|---|---|---|
| F11 | **Google Ads API連携** | OAuth認証でGoogle広告データを自動取得 |
| F12 | **Meta Marketing API連携** | Meta広告データを自動取得 |
| F13 | **3テストプロセス自動化** | ラグなし→ラグあり→ダミー追加の講義準拠3ステップを自動実行 |
| F14 | **週次自動更新** | データ取得→MMM再実行を毎週自動実行、結果をメール/Slack通知 |
| F15 | **英語UI** | 多言語対応（日本語/英語切替） |
| F16 | **在庫切れ自動検知** | Inventory APIを日次監視し欠品日を自動でcontext_varに反映 |

### 3.3 v3.0（エンタープライズ）

| # | 機能 | 詳細 |
|---|---|---|
| F17 | **Amazon SP-API連携** | Amazon広告・売上データ自動取得 |
| F18 | **Solver自動実行** | 予算配分最適化をアプリ内で完結（Excel Solver不要） |
| F19 | **シナリオプランナー** | 「広告費を20%増やしたら？」のシミュレーション |
| F20 | **マルチストア対応** | 複数Shopifyストアの統合分析 |
| F21 | **AIインサイト** | 結果の自然言語解説・改善提案（LLM連携） |

---

## 4. 画面構成（UXフロー）

```
[1] インストール＆認証
 │  └── Shopify OAuthフロー → 売上/分析データへのアクセス許可
 ▼
[2] ダッシュボード（ホーム画面）
 │  ├── Shopify売上データのプレビュー（自動取得済み）
 │  ├── 「分析を始める」ボタン
 │  └── 過去の分析結果一覧
 ▼
[3] データ準備画面
 │  ├── Step 1: Shopifyデータ確認（自動取得済み、編集可能）
 │  ├── Step 2: 広告データ追加
 │  │   ├── 「Excelテンプレートをダウンロード」ボタン
 │  │   ├── 「記入済みExcelをアップロード」ボタン
 │  │   └── バリデーション結果表示（エラー/警告/OK）
 │  ├── Step 3: チャネル設定
 │  │   ├── media_var の選択（IMP推奨、click代替、cost最終手段）
 │  │   └── チャネル名のカスタマイズ
 │  └── Step 4: データプレビュー＆確認
 ▼
[4] 分析実行画面
 │  ├── 「分析を実行」ボタン
 │  ├── 進捗バー（MMM実行中…約3-5分）
 │  └── 完了通知
 ▼
[5] 結果画面
 │  ├── Tab 1: チャネル別貢献度（棒グラフ + 円グラフ）
 │  ├── Tab 2: 飽和曲線（チャネル別）
 │  ├── Tab 3: 予算配分提案（現状 vs 最適）
 │  ├── Tab 4: R²・モデル精度
 │  ├── 「結果をExcelでダウンロード」ボタン
 │  └── 「分析を再実行」ボタン
 ▼
[6] 設定画面
    ├── 分析期間の設定
    ├── 目的変数の選択（売上 or 注文数）
    ├── プラン管理（Billing）
    └── データ削除リクエスト（GDPR）
```

---

## 5. 非機能要件

### 5.1 パフォーマンス

| 項目 | 目標 |
|---|---|
| ページ読み込み | 2秒以内 |
| ShopifyQLデータ取得 | 10秒以内（180日分） |
| Excelアップロード処理 | 5秒以内（365行） |
| MMM実行時間 | 5分以内 |
| 同時実行ユーザー | 50ユーザー |

### 5.2 セキュリティ

- Shopify Session Token認証（サードパーティCookie禁止）
- HTTPS必須
- クリックジャッキング防止ヘッダー
- ユーザーデータは暗号化して保存
- GDPR準拠（データ削除リクエスト30日以内対応）

### 5.3 可用性

- SLA 99.5%（MVP段階）
- 自動バックアップ（DB: 日次）
- エラー監視（Sentry等）

---

## 6. 料金設計

### 6.1 価格プラン

| プラン | 月額 | 対象 | 機能 |
|---|---|---|---|
| **Starter** | **$99/月** | 月商100万〜3,000万円 | Shopify自動取得 + Excel補完 + MMM実行（月2回）+ 基本ダッシュボード |
| **Growth** | **$199/月** | 月商3,000万〜1億円 | 上記 + Google/Meta API連携 + 週次自動更新 + 3テストプロセス |
| **Pro** | **$299/月** | 月商1億円以上 | 上記 + シナリオプランナー + マルチストア + 優先サポート |
| **Free Trial** | **14日間無料** | 全ユーザー | Growth相当の機能を体験 |

### 6.2 競合価格比較

| アプリ | MMM機能の価格 | 日本語 | マルチモール |
|---|---|---|---|
| Triple Whale | $549〜$1,129+/月 | なし | なし |
| Northbeam | $1,000〜$2,500+/月 | なし | なし |
| Rockerbox | $200〜$2,000+/月 | なし | なし |
| XICA MAGELLAN | 要問合せ（高額） | あり | あり |
| **当アプリ** | **$99〜$299/月** | **あり** | **あり（Excel経由）** |

### 6.3 Shopifyレベニューシェア

- 累計$1M以下: **0%**（手数料なし）
- 累計$1M超: **15%**

---

## 7. ロードマップ

```
Phase 1: 基盤構築（4週間）
├── Week 1: Shopify CLI セットアップ + 開発ストア作成
├── Week 2: 認証フロー + ShopifyQL データ取得
├── Week 3: DB設計 + データモデル + Excel パーサー
└── Week 4: Polaris UI スケルトン + App Bridge統合

Phase 2: コア機能実装（6週間）
├── Week 5-6: Excelテンプレート DL/UL + バリデーション
├── Week 7-8: MMM計算エンジン（Python）+ 非同期実行
├── Week 9-10: 結果ダッシュボード + Excelダウンロード

Phase 3: 品質保証（3週間）
├── Week 11: GDPR Webhook + Billing実装
├── Week 12: E2Eテスト + 開発ストアでのQA
└── Week 13: アプリリスティング作成

Phase 4: ローンチ（2週間）
├── Week 14: App Store審査提出
└── Week 15-16: 審査対応 + 修正 + 公開

合計: 約4ヶ月（16週間）
```

---

## 8. App Store 審査チェックリスト

- [ ] GraphQL Admin API のみ使用（REST不可）
- [ ] Polaris Web Components でUI構築
- [ ] App Bridge セッショントークン認証
- [ ] 3つのGDPR Webhook実装・応答
  - [ ] `customers/data_request`
  - [ ] `customers/redact`
  - [ ] `shop/redact`
- [ ] Billing設定（Managed Pricing）
- [ ] HTTPS + クリックジャッキング防止ヘッダー
- [ ] アプリアイコン（1200x1200px）
- [ ] スクリーンショット（1600x900px × 3-6枚）
- [ ] アプリ説明文（日本語 + 英語）
- [ ] プライバシーポリシーURL
- [ ] `read_all_orders` スコープ申請
- [ ] `read_reports` スコープ

---

## 9. リスクと対策

| リスク | 影響度 | 対策 |
|---|---|---|
| MMMエンジンのサーバー運用困難 | 高 | Python実装（LightweightMMM/PyMC）を採用。Rは避ける |
| App Store審査リジェクト | 中 | GDPR/Billing/認証の3大理由を事前に完全対応 |
| MMM精度不足（R²低い） | 高 | 手動データ補完UXを徹底的に磨く。R²ガイドをアプリ内に組込 |
| ユーザーがExcelを埋められない | 高 | ステップバイステップの入力ガイド + 最低限のデータでも動く設計 |
| 競合の値下げ | 中 | 日本市場特化 + マルチモール対応で差別化 |
| Shopify API仕様変更 | 低 | APIバージョン管理 + 半年ごとのマイグレーション |
